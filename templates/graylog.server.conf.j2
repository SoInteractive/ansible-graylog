# {{ ansible_managed }}
is_master = true
node_id_file = /etc/graylog/server/node-id
password_secret = {{ graylog_password_salt }}

root_username = {{ graylog_root.username }}
# Create one by using for example: echo -n yourpassword | shasum -a 256
root_password_sha2 = {{ graylog_sha256sum['content'] | b64decode }}
root_email = {{ graylog_root.email }}
root_timezone = UTC

plugin_dir = /usr/share/graylog-server/plugin

rest_listen_uri = http://{{ graylog_address }}/api/
web_enable = true
web_listen_uri = http://{{ graylog_address }}/

rotation_strategy = {{ graylog_rotation_strategy }}

elasticsearch_hosts = {% for item in graylog_elasticsearch_hosts %}{{ item }}{% if not loop.last %},{% endif %} {% endfor %}

elasticsearch_max_docs_per_index = {{ graylog_max_docs_per_index }}
elasticsearch_max_number_of_indices = {{ graylog_max_number_of_indices }}
retention_strategy = {{ graylog_retention_strategy }}
elasticsearch_shards = {{ graylog_elasticsearch_shards }}
elasticsearch_replicas = {{ graylog_elasticsearch_replicas }}
elasticsearch_index_prefix = {{ graylog_elasticsearch_index_prefix }}

allow_leading_wildcard_searches = false
allow_highlighting = false
elasticsearch_analyzer = standard
output_batch_size = 500
output_flush_interval = 1
output_fault_count_threshold = 5
output_fault_penalty_seconds = 30
processbuffer_processors = 5
outputbuffer_processors = 3
processor_wait_strategy = blocking
ring_size = 65536
inputbuffer_ring_size = 65536
inputbuffer_processors = 2
inputbuffer_wait_strategy = blocking
message_journal_enabled = true
message_journal_dir = /var/lib/graylog-server/journal
lb_recognition_period_seconds = 3

mongodb_uri = mongodb://{% if graylog_mongodb.user is defined and graylog_mongodb.pass is defined %}{{ graylog_mongodb.user }}:{{ graylog_mongodb.pass }}@{% endif %}{{ graylog_mongodb.hosts|join(',') }}/{{ graylog_mongodb.collection }}{% if graylog_mongodb.replicaset is defined %}?replicaSet={{ graylog_mongodb.replicaset }}{% endif %}

mongodb_max_connections = 1000
mongodb_threads_allowed_to_block_multiplier = 5

content_packs_dir = /usr/share/graylog-server/contentpacks
content_packs_auto_load = grok-patterns.json
proxied_requests_thread_pool_size = 32

{#
transport_email_enabled = {{ graylog_transport_email_enabled }}
transport_email_hostname = {{ graylog_transport_email_hostname }}
transport_email_port = {{ graylog_transport_email_port }}
transport_email_use_auth = {{ graylog_transport_email_use_auth }}
transport_email_use_tls = {{ graylog_transport_email_use_tls }}
transport_email_use_ssl = {{ graylog_transport_email_use_ssl }}
transport_email_auth_username = {{ graylog_transport_email_auth_username }}
transport_email_auth_password = {{ graylog_transport_email_auth_password }}
transport_email_subject_prefix = {{ graylog_transport_email_subject_prefix }}
transport_email_from_email = {{ graylog_transport_email_from_email }}
transport_email_web_interface_url = {{ graylog_transport_email_web_interface_url }}
#}
